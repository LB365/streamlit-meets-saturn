{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "usermeta": {
    "dataset": [
      {
        "key": "__0__",
        "name": "date",
        "description": "",
        "type": "dateTime",
        "kind": "column"
      },
      {
        "key": "__1__",
        "name": "predicted",
        "description": "Boolean flagging if the data is predicted",
        "type": "bool",
        "kind": "column"
      },
      {
        "key": "__2__",
        "name": "Value",
        "description": "",
        "type": "numeric",
        "kind": "measure"
      }
    ]
  },
  "config": {
    "axis": {
      "domainWidth": 1,
      "grid": true,
      "labelPadding": 2,
      "tickSize": 5,
      "tickWidth": 0.5,
      "titleFontWeight": "bold",
      "labelFontSize": 16
    },
    "axisBand": {"grid": false},
    "axisX": {"gridWidth": 0.5},
    "axisY": {"gridWidth": 1},
    "legend": {
      "labelFontSize": 16,
      "padding": 1,
      "symbolSize": 100,
      "symbolType": "square",
      "symbolStrokeWidth": 3
    },
    "range": {
      "category": [
        "#3e5c69",
        "#6793a6",
        "#182429",
        "#0570b0",
        "#3690c0",
        "#74a9cf",
        "#a6bddb",
        "#e2ddf2"
      ]
    }
  },
  "data": {"name": "dataset"},
  "params": [{"name": "cutoff_year", "value": 2018}],
  "transform": [
    {
      "filter": "!((month(datum['__0__']) == 1) && (date(datum['__0__']) == 29))"
    },
    {"calculate": "now()", "as": "today"},
    {"calculate": "year(datum['__0__'])", "as": "year"},
    {"timeUnit": "monthdate", "field": "__0__", "as": "doy"},
    {
      "joinaggregate": [
        {"op": "median", "field": "__2__", "as": "mval"},
        {"op": "q3", "field": "__2__", "as": "maxval"},
        {"op": "q1", "field": "__2__", "as": "minval"}
      ],
      "groupby": ["doy"]
    }
  ],
  "encoding": {
    "x": {"field": "__0__", "type": "temporal", "title": "", "axis":{"format": "%b-%y"}},
    "y": {"scale": {"zero": false}}
  },
  "layer": [
    {
      "mark": {"opacity": 0.2, "type": "area", "tooltip": false},
      "encoding": {
        "y": {"field": "minval", "type": "quantitative"},
        "y2": {"field": "maxval"}
      }
    },
    {
      "mark": {
        "type": "line",
        "tooltip": true,
        "strokeWidth": 0.45,
        "stroke": "black"
      },
      "encoding": {"y": {"field": "mval", "type": "quantitative", "title": ""}}
    },
    {
      "params": [
        {
          "name": "hover",
          "value": [
            {
              "year": [
                2015,
                2016,
                2017,
                2018,
                2019,
                2020,
                2021,
                2022,
                2023,
                2024,
                2025
              ]
            }
          ],
          "select": {"type": "point", "fields": ["year"], "on": "mouseover"}
        }
      ],
      "mark": {"type": "line", "tooltip": true},
      "encoding": {
        "y": {"field": "__2__", "type": "quantitative"},
        "strokeDash": {
          "field": "datum['__1__']",
          "type": "nominal",
          "legend": null
        }
      }
    },
    {
      "mark": {"type": "rule"},
      "encoding": {
        "x": {"field": "today"},
        "strokeDash": {"value": [2, 4]},
        "strokeWidth": {"value": 0.5},
        "color": {"value": "grey"}
      }
    }
  ],
  "autosize": {"type": "fit", "contains": "padding"},
  "padding": {"bottom": 20}
}